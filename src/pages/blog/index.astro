---
import { Image } from 'astro:assets';
import { getCollection } from 'astro:content';
import BaseHead from '../../components/BaseHead.astro';
import Footer from '../../components/Footer.astro';
import FormattedDate from '../../components/FormattedDate.astro';
import Header from '../../components/Header.astro';
import TitleIcon from '../../components/TitleIcon.astro';
import OsIcon from '../../components/OsIcon.astro';
import { SITE_DESCRIPTION, SITE_TITLE } from '../../consts';

const posts = (await getCollection('blog')).sort(
    (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);
---

<!doctype html>
<html lang="en">
    <head>
        <BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
    </head>
    <body class="bg-base-100 text-base-content font-atkinson">
        <Header />
        <main class="max-w-5xl mx-auto px-4 py-12">
<section>
  <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
    {
      posts.map((post, index) => {
        const isFeatured = index === 0;

        return (
          <div
            class:list={[
              "card bg-base-200 shadow-sm hover:shadow-xl transition-all duration-300 border border-base-300 overflow-hidden",
              { "md:col-span-2 flex-row": isFeatured },
            ]}
          >
            <a href={`/blog/${post.id}/`} class="contents">
              {post.data.heroImage && (
                <figure class={isFeatured ? "w-full md:w-1/2" : "w-full"}>
                  <Image
                    width={720}
                    height={360}
                    src={post.data.heroImage}
                    alt=""
                    class="object-cover h-full w-full aspect-video"
                  />
                </figure>
              )}

              {/* Make body a flex column so footer can sit at bottom */}
              <div class="card-body flex flex-col">
                <div class="text-sm opacity-60">
                  <FormattedDate date={post.data.pubDate} />
                </div>

                <h2
                  class:list={[
                    "card-title hover:text-primary transition-colors",
                    isFeatured ? "text-3xl" : "text-xl",
                  ]}
                >
                  {post.data.title}
                </h2>

                <p class="line-clamp-2 opacity-80 mb-4">{post.data.description}</p>

                {/* Footer row pinned to bottom */}
                <div class="mt-auto pt-4 border-t border-primary/10 flex items-center justify-between">
                  {/* Left: icons */}
                  <div class="flex items-center gap-4">
                    <div
                      class="tooltip tooltip-bottom opacity-80 hover:opacity-100 transition-opacity flex items-center"
                      data-tip={post.data.postType}
                    >
                      <TitleIcon postType={post.data.postType} />
                    </div>

                    {post.data.osType && (
                      <div
                        class="tooltip tooltip-bottom opacity-80 hover:opacity-100 transition-opacity flex items-center"
                        data-tip={post.data.osType}
                      >
                        <OsIcon osType={post.data.osType} />
                      </div>
                    )}
                  </div>

                  {/* Right: difficulty */}
                  <div
                    class="tooltip tooltip-bottom"
                    data-tip={post.data.difficulty || "Log"}
                  >
                    <div class="badge badge-outline badge-sm opacity-60 font-mono text-[10px] uppercase tracking-tighter">
                      {post.data.difficulty || "Log"}
                    </div>
                  </div>
                </div>
              </div>
            </a>
          </div>
        );
      })
    }
  </div>
</section>
        </main>
        <Footer />
    </body>
</html>
