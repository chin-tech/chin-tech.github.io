---
import BaseHead from '../components/BaseHead.astro';
import Footer from '../components/Footer.astro';
import Header from '../components/Header.astro';
import TitleIcon from '../components/TitleIcon.astro';
import OsIcon from '../components/OsIcon.astro';
import { Image } from 'astro:assets';
import { SITE_DESCRIPTION, SITE_TITLE } from '../consts';
import { getCollection } from 'astro:content';

const recent_posts = (await getCollection('blog')).sort(
    (a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
).slice(0, 5);


function shuffle(arr) {
  for (let i = arr.length - 1; i > 0; i--) {
    const j = Math.floor(Math.random() * (i + 1));
    [arr[i], arr[j]] = [arr[j], arr[i]];
  }
  return arr;
}
const skills = shuffle([
//  Languages
	"Python", "Bash", "C", "Zig", "Javascript", "SQL",
// Tools
	"Kubernetes" , "Terraform", "Ansible", "Wireshark", "Docker",
// Pentesting
	"Active Directory", "Linux (RHEL/Debian/Arch)", "Windows", "Metasploit", "Netexec", 
// Debuggers
    "GDB", "Ghidra",
// Frameworks
	"Astro", "Tailwind", 
// Cloud
	"AWS", "Google Cloud",
]);

---

<!doctype html>
<html lang="en">
    <head>
        <BaseHead title={SITE_TITLE} description={SITE_DESCRIPTION} />
        <style>
            /* Disable snapping and hide scrollbars for seamless JS scrolling */
            #post-carousel, #skills-carousel {
                display: flex;
                flex-wrap: nowrap;
                scroll-snap-type: none !important;
                scroll-behavior: auto !important; /* Critical: 'smooth' causes jitter with JS */
                scrollbar-width: none;
                -ms-overflow-style: none;
            }

            #post-carousel::-webkit-scrollbar, 
            #skills-carousel::-webkit-scrollbar {
                display: none;
            }
        </style>
    </head>
    <body class="bg-base-100 text-base-content font-mono">
        <Header />
        <main class="max-w-6xl mx-auto px-4 py-12">
            
            <section class="mb-16">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="card bg-base-200 shadow-xl border border-primary/20">
                        <div class="card-body">
                            <div class="flex items-center gap-4">
                                <div class="avatar online">
                                    <div class="w-16 rounded-full ring ring-primary ring-offset-base-100 ring-offset-2 text-center items-center justify-center flex overflow-hidden">
                                        <Image src={import('../assets/avatar_two.jpg')} alt="Avatar" width={64} height={64}/>
                                    </div>
                                </div>
                                <div>
                                    <h4 class="card-title">Alex</h4>
                                    <p class="text-xs opacity-60 uppercase tracking-widest text-primary">Status: Mission Ready</p>

                                      <div class="stat-title"> Views </div>
                                      <div id="view_value" class="stat-value"> <span class="loading loading-infinity loading-sm"></span> </div>
                                  <!-- </div> -->
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="md:col-span-2 stats shadow bg-base-200 border border-primary/20 overflow-x-auto">
                        <div class="stat">
                            <div class="stat-title text-xs uppercase opacity-50">Certifications</div>
                            <div class="stat-value text-primary text-2xl">7+</div>
                            <div class="stat-desc text-secondary">CPTS, Sec+, LPIC-1</div>
                        </div>
                        <div class="stat border-l border-primary/10">
                            <div class="stat-title text-xs uppercase opacity-50">Professional Experience</div>
                            <div class="stat-value text-primary text-2xl">8 Years</div>
                            <div class="stat-desc">NSA/USAF • SIGINT • PROGRAMMING • CYBERSECURITY</div>
                        </div>
                    </div>
                </div>
            </section>

            <section class="mb-16">
                <div class="flex items-center gap-4 mb-6">
                    <h2 class="text-xs font-bold uppercase tracking-[0.4em] opacity-50 whitespace-nowrap">Technical Arsenal</h2>
                    <div class="h-px bg-primary/20 w-full"></div>
                </div>
                
                <div id="skills-carousel" class="carousel carousel-center w-full p-4 space-x-4 bg-transparent cursor-default overflow-x-hidden">
                    {/* Double the content for a seamless loop */}
                    {[...skills, ...skills].map((skill) => (
                        <div class="carousel-item">
                            <div class="px-6 py-2 border border-primary/30 rounded-full bg-primary/5 text-primary text-xs font-bold uppercase tracking-widest whitespace-nowrap">
                                {skill}
                            </div>
                        </div>
                    ))}
                </div>
            </section>

<section class="mb-20">
    <div class="flex justify-between items-end mb-8 border-b border-primary/20 pb-2">
        <h2 class="text-2xl font-bold italic uppercase tracking-tighter">Recent Intel / Blog</h2>
        <a href="/blog" class="link link-primary text-xs uppercase">View Archive</a>
    </div>

    <div id="post-carousel" class="carousel carousel-center max-w-full p-4 space-x-6 bg-base-300/50 rounded-box overflow-x-hidden">
        {[...recent_posts, ...recent_posts].map((post) => (
            <div class="carousel-item w-full md:w-1/2 lg:w-1/3">
                <a href={`/blog/${post.id}/`} class="card bg-base-100 shadow-xl hover:scale-[1.02] transition-transform duration-300 overflow-hidden border border-white/5 flex flex-col h-full">
                    
                    {/* Hero Image */}
                    {post.data.heroImage && (
                        <figure>
                            <Image width={400} height={200} src={post.data.heroImage} alt="" class="object-cover h-48 w-full" />
                        </figure>
                    )}

                    {/* Content Body */}
                    <div class="card-body p-6 flex flex-col flex-grow">
                        <h2 class="card-title text-primary text-lg">{post.data.title}</h2>
                        <p class="text-sm line-clamp-2 opacity-80 mb-4">{post.data.description}</p>
                        
                        {/* Technical Footer Row */}
                        <div class="mt-auto pt-4 border-t border-primary/10 flex items-center justify-between">
                            
                            {/* Left Side: Tech Icons */}
                            <div class="flex items-center gap-4">
                                <div class="opacity-80 hover:opacity-100 transition-opacity flex items-center">

                                    <div class="tooltip tooltip-right" data-tip={post.data.postType}>
                                    <TitleIcon postType={post.data.postType} />
                                            </div>
                                </div>
                                
                                {post.data.osType && (
                                    <div class="tooltip tooltip-right" data-tip={post.data.osType}>
											<OsIcon osType={post.data.osType}/>
                                    </div>
                                )}
                            </div>

                            {/* Right Side: Difficulty */}
                            <div class="badge badge-outline badge-sm opacity-50 font-mono text-[10px] uppercase tracking-tighter">
                                {post.data.difficulty || 'Log'}
                            </div>

                        </div>
                    </div>
                </a>
            </div>
        ))}
    </div>
</section>
        </main>
        <Footer />

        <script src="/src/scripts/carousels.js"/>
        <script src="/src/scripts/viewCounter.js"/>
    </body>
</html>
